concat     = require 'gulp-concat'
autoReload = require 'gulp-auto-reload'

# reloader will inject <script> tag
htmlInject = -> gutil.noop()

paths =
  html: "src/**/*.html"
  css:  "src/**/*.css"

outapp = "dist"

# reloader will inject <script> tag
htmlInject = -> gutil.noop()

# copy .html-files
gulp.task 'html', ->
  gulp.src paths.html
    .pipe htmlInject()
    .pipe gulp.dest outapp

# concat css
gulp.task 'css', ->
  gulp.src paths.css
    .pipe concat('ui/app.css')
    .pipe gulp.dest outapp

gulp.task 'reloader', ->
  # create an auto reload server instance
  reloader = autoReload()

  # copy the client side script
  reloader.script()
    .pipe gulp.dest outapp

  # inject scripts in html
  htmlInject = reloader.inject

  # watch rebuilt stuff
  gulp.watch "#{outapp}/**/*", reloader.onChange

gulp.task 'default', ['html', 'css']

gulp.task 'watch', ['reloader', 'html'], ->
  # rebuild on all source changes
  gulp.watch './src/**/*', ['default']
